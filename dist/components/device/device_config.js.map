{"version":3,"sources":["../../../src/components/device/device_config.js"],"names":["_","angular","_defaultCheck","settings","healthSettings","notifications","num_collectors","steps","route","type","config","DeviceConfigCtrl","$scope","$injector","$rootScope","$location","$modal","$anchorScroll","$timeout","$window","$q","backendSrv","alertSrv","self","scope","rootscope","pageReady","ds18b20","channels","deviceStatus","ignoreChanges","console","log","search","loadDevice","device","onbeforeunload","changesPending","$on","event","next","preventDefault","baseLen","absUrl","length","url","nextUrl","substring","modalScope","$new","ignore","save","savePending","appEvent","src","modalClass","showConfig","reset","history","back","uid","newTempSensorID","label","id","delete","then","resp","meta","code","set","message","reject","path","orgid","contextSrv","user","orgId","userid","put","get","body","changes","templateUrl"],"mappings":"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","file":"device_config.js","sourcesContent":["import _ from 'lodash';\nimport angular from 'angular';\n\nvar _defaultCheck = {\n  settings: {},\n  healthSettings: {\n    notifications: {},\n    num_collectors: 3,\n    steps: 3\n  },\n  route: {\n    type: \"byIds\",\n    config: {\n      \"ids\": []\n    }\n  }\n};\n\nclass DeviceConfigCtrl {\n  /** @ngInject */\n  constructor($scope, $injector, $rootScope, $location, $modal, $anchorScroll, $timeout, $window, $q, backendSrv, alertSrv) {\n    var self = this;\n    this.backendSrv = backendSrv;\n    this.$location = $location;\n    this.$timeout = $timeout;\n    this.$q = $q;\n    this.alertSrv = alertSrv;\n    this.$window = $window;\n    this.$rootScope = $rootScope;\n\n    $window.scope = $scope;\n    $window.rootscope = $rootScope;\n\n    this.pageReady = false;\n    this.config = {};\n    this.config.ds18b20 = {};\n    this.config.channels = {};\n    this.deviceStatus = 0; // 0 = new, stage 1, 1 = new, adding information stage, 2 = exiting\n\n    this.ignoreChanges = false;\n\n    $window.console.log($location.search());\n    if (\"device\" in $location.search()) {\n      this.deviceStatus = 2;\n      this.loadDevice($location.search().device);\n    } else {\n      this.deviceStatus = 0;\n    }\n\n    self.pageReady = true;\n\n    $window.onbeforeunload = function() {\n      if (self.ignoreChanges) {\n        return;\n      }\n      if (self.changesPending()) {\n        return \"There are unsaved changes to this dashboard\";\n      }\n    };\n\n    $scope.$on('$locationChangeStart', function(event, next) {\n      if ((!self.ignoreChanges) && (self.changesPending())) {\n        event.preventDefault();\n        var baseLen = $location.absUrl().length - $location.url().length;\n        var nextUrl = next.substring(baseLen);\n        var modalScope = $scope.$new();\n        modalScope.ignore = function() {\n          self.ignoreChanges = true;\n          $location.url(nextUrl);\n          return;\n        };\n\n        modalScope.save = function() {\n          self.savePending(nextUrl);\n        };\n\n        $rootScope.appEvent('show-modal', {\n          src: 'public/app/partials/unsaved-changes.html',\n          modalClass: 'confirm-modal',\n          scope: modalScope,\n        });\n      }\n    });\n  }\n\n  reset() {\n    var self = this;\n    this.showConfig = false;\n    this.config = {};\n  }\n\n  cancel() {\n    this.reset();\n    this.ignoreChanges = true;\n    this.$window.history.back();\n  }\n\n  addDevice() {\n    if (!this.config.uid) {\n      return;\n    }\n    this.deviceStatus = 1;\n  }\n\n  addDs18b20() {\n    this.config.ds18b20[this.newTempSensorID] = {};\n    this.config.ds18b20[this.newTempSensorID].label = \"New Sensor (Click to edit)\";\n    this.newTempSensorID = '';\n\n  }\n\n  delDs18b20(id) {\n    delete this.config.ds18b20[id];\n    this.$window.console.log(this.config);\n\n  }\n\n  removeDevice() {\n    var self = this;\n    return this.backendSrv.delete('api/plugin-proxy/flexscada-app/api/vibration/v1/config/' + this.config.uid).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to delete device.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      self.$location.path('plugins/flexscada-app/page/devices');\n    });\n  }\n\n  saveDevice() {\n\n    this.config.orgid = this.$rootScope.contextSrv.user.orgId;\n    this.config.userid = this.$rootScope.contextSrv.user.id;\n\n    var self = this;\n    return this.backendSrv.put('api/plugin-proxy/flexscada-app/api/vibration/v1/config/' + this.config.uid + ((this.deviceStatus === 1) ? '/?create=true' : ''), this.config).then((resp) => {\n      self.$window.console.log(resp);\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to update device.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      this.deviceStatus = 2;\n    });\n  }\n\n  loadDevice(uid) {\n    var self = this;\n    return this.backendSrv.get('api/plugin-proxy/flexscada-app/api/vibration/v1/config/' + uid).then((resp) => {\n      self.$window.console.log(resp);\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to update device.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      self.config = resp.body;\n      this.deviceStatus = 2;\n    });\n  }\n\n  gotoDashboard() {\n    // Load the devices dashboard\n  }\n\n  changesPending() {\n    var self = this;\n    var changes = false;\n\n    return changes;\n  }\n\n}\n\nDeviceConfigCtrl.templateUrl = 'public/plugins/flexscada-app/components/device/partials/device_config.html';\n\nexport {\n  DeviceConfigCtrl\n};\n"]}